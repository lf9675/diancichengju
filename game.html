<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶£å‘³æ±‰è¯­ - ç‚¹è¯æˆå¥</title>
    <style>
        :root {
            --primary-pink: #ffcdd2; /* æµ…ç²‰èƒŒæ™¯ */
            --dark-pink: #ef9a9a;    /* æ·±ç²‰è¾¹æ¡† */
            --text-color: #4e342e;   /* æ·±è¤è‰²å­—ä½“ */
            --bg-blue: #e3f2fd;      /* æµ…è“èƒŒæ™¯ */
            --btn-shadow: 0 4px 0 #e57373; /* æŒ‰é’®ç«‹ä½“é˜´å½± */
        }

        body {
            font-family: "Rounded Mplus 1c", "Microsoft YaHei", "Heiti SC", sans-serif;
            background-color: var(--bg-blue);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none; /* é˜²æ­¢é€‰ä¸­æ–‡æœ¬ */
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒº */
        header {
            margin-top: 20px;
            text-align: center;
        }

        h1 {
            background-color: var(--primary-pink);
            color: var(--text-color);
            padding: 10px 30px;
            border-radius: 20px;
            border: 2px dashed #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-size: 24px;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 80%;
            height: 10px;
            background-color: #fff;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #81c784;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        .game-area {
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        /* 1. ç›®æ ‡åŒºåŸŸ (å¥å­æ¡†) */
        .target-box {
            background-color: rgba(255, 255, 255, 0.6);
            border: 3px dashed var(--dark-pink);
            border-radius: 20px;
            min-height: 150px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            padding: 15px;
            gap: 10px;
            position: relative;
            transition: all 0.3s;
        }

        .placeholder-text {
            position: absolute;
            color: #b0bec5;
            font-size: 18px;
            pointer-events: none;
        }

        /* 2. è¯æ±‡æºåŒºåŸŸ */
        .source-box {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            min-height: 100px;
            padding: 10px;
        }

        /* è¯æ±‡æŒ‰é’®æ ·å¼ */
        .word-btn {
            background-color: var(--primary-pink);
            color: var(--text-color);
            font-size: 24px; /* å¤§å­—å· */
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px dashed #fff;
            cursor: pointer;
            box-shadow: var(--btn-shadow);
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
            top: 0;
        }

        .word-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 transparent;
        }

        /* æ£€æŸ¥æŒ‰é’® */
        .check-btn {
            background-color: #81c784; /* ç»¿è‰² */
            color: white;
            font-size: 22px;
            padding: 15px;
            border: none;
            border-radius: 50px;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 4px 0 #4caf50;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .check-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 transparent;
        }

        .check-btn.disabled {
            background-color: #cfd8dc;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
            border-color: #ff5252;
        }

        /* æˆåŠŸæç¤º */
        .feedback {
            height: 30px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
        .success-text { color: #4caf50; }
        .error-text { color: #ff5252; }

    </style>
</head>
<body>

<header>
    <h1>ç‚¹è¯æˆå¥</h1>
</header>

<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>

<div class="game-area">
    
    <div class="target-box" id="targetBox">
        <span class="placeholder-text">ç‚¹å‡»ä¸‹æ–¹çš„è¯ç»„æˆå¥å­</span>
    </div>

    <div class="source-box" id="sourceBox">
        </div>

    <div class="feedback" id="feedback"></div>

    <button class="check-btn" id="checkBtn" onclick="checkAnswer()">æ£€æŸ¥å¥å­</button>
</div>

<script>
    // ----------------é…ç½®åŒºåŸŸ (æ‚¨å¯ä»¥ä¿®æ”¹è¿™é‡Œçš„é¢˜ç›®)----------------
    const levels = [
        {
            words: ["å¦ˆå¦ˆ", "åœ¨", "å¨æˆ¿", "åšé¥­"],
            correct: "å¦ˆå¦ˆåœ¨å¨æˆ¿åšé¥­"
        },
        {
            words: ["ä»Šå¤©", "å¤©æ°”", "éå¸¸", "å¥½"],
            correct: "ä»Šå¤©å¤©æ°”éå¸¸å¥½"
        },
        {
            words: ["æˆ‘", "æƒ³", "å»", "ä¸­å›½", "æ—…æ¸¸"],
            correct: "æˆ‘æƒ³å»ä¸­å›½æ—…æ¸¸"
        },
        {
            words: ["è¿™", "æ˜¯", "ä»€ä¹ˆ", "æ°´æœ"],
            correct: "è¿™æ˜¯ä»€ä¹ˆæ°´æœ"
        }
    ];

    // ----------------æ¸¸æˆé€»è¾‘----------------
    let currentLevel = 0;
    let selectedWords = []; // ç©å®¶å½“å‰é€‰ä¸­çš„è¯
    
    const targetBox = document.getElementById('targetBox');
    const sourceBox = document.getElementById('sourceBox');
    const feedback = document.getElementById('feedback');
    const checkBtn = document.getElementById('checkBtn');
    const progressBar = document.getElementById('progressBar');

    // åˆå§‹åŒ–æ¸¸æˆ
    function initGame() {
        if (currentLevel >= levels.length) {
            gameComplete();
            return;
        }

        selectedWords = [];
        feedback.textContent = "";
        feedback.className = "feedback";
        targetBox.classList.remove("shake");
        
        // æ›´æ–°è¿›åº¦æ¡
        progressBar.style.width = `${(currentLevel / levels.length) * 100}%`;
        checkBtn.textContent = "æ£€æŸ¥å¥å­";
        checkBtn.onclick = checkAnswer;
        checkBtn.style.backgroundColor = "#81c784";
        checkBtn.style.boxShadow = "0 4px 0 #4caf50";

        // è·å–å½“å‰é¢˜ç›®çš„è¯æ±‡å¹¶æ‰“ä¹±
        const levelData = levels[currentLevel];
        // å¤åˆ¶ä¸€ä»½æ•°ç»„ç”¨äºæ‰“ä¹±ï¼Œä¸å½±å“åŸæ•°æ®
        let shuffledWords = [...levelData.words].sort(() => Math.random() - 0.5);

        renderUI(shuffledWords);
    }

    // æ¸²æŸ“ç•Œé¢
    function renderUI(sourceWords) {
        // æ¸…ç©ºå®¹å™¨
        targetBox.innerHTML = '';
        sourceBox.innerHTML = '';

        // æ˜¾ç¤ºå ä½ç¬¦
        if (selectedWords.length === 0) {
            targetBox.innerHTML = '<span class="placeholder-text">ç‚¹å‡»è¯è¯­ç»„æˆå¥å­</span>';
        }

        // æ¸²æŸ“å·²é€‰ä¸­çš„è¯ (ä¸Šæ–¹)
        selectedWords.forEach((word, index) => {
            const btn = createWordBtn(word);
            btn.onclick = () => removeWord(index); // ç‚¹å‡»ä¸Šæ–¹è¯ï¼Œç§»é™¤
            targetBox.appendChild(btn);
        });

        // æ¸²æŸ“å¾…é€‰è¯ (ä¸‹æ–¹) - è¿‡æ»¤æ‰å·²é€‰çš„
        // è¿™é‡Œçš„é€»è¾‘ç¨å¾®å¤æ‚ï¼šæˆ‘ä»¬éœ€è¦è¿½è¸ªå“ªäº›è¯åœ¨ä¸‹é¢ã€‚
        // ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬æ¯æ¬¡æ ¹æ®â€œå‰©ä½™è¯â€é‡æ–°æ¸²æŸ“ä¸‹æ–¹ã€‚
        // ä½†ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œé€šå¸¸ä¸ä»…æ˜¯è¿‡æ»¤ï¼Œè€Œæ˜¯çŠ¶æ€å˜åŒ–ã€‚
        // è¿™é‡Œé‡‡ç”¨ç®€å•æ¨¡å¼ï¼šä¸‹æ–¹åªæ˜¾ç¤ºæœªè¢«é€‰ä¸­çš„è¯ã€‚
        
        // é‡æ–°è®¡ç®—ä¸‹æ–¹æ˜¾ç¤ºçš„è¯ï¼šè¿™é‡Œä¸ºäº†é€»è¾‘ç®€å•ï¼Œæˆ‘ä»¬ä¸ä¸¥æ ¼è¿½è¸ªåŸå§‹ä¹±åºçš„ä½ç½®ï¼Œ
        // è€Œæ˜¯å°†æœªé€‰ä¸­çš„è¯æ˜¾ç¤ºåœ¨ä¸‹æ–¹ã€‚
        // *æ³¨æ„ï¼šè¿™ä¼šå¯¼è‡´æ¯æ¬¡ç‚¹å‡»ä¸‹æ–¹è¯ä¼šé‡æ–°æ’åºï¼Œä¸ºäº†ä½“éªŒæ›´å¥½ï¼Œ
        // æˆ‘ä»¬å¯ä»¥åªéšè—ä¸‹æ–¹æŒ‰é’®ï¼Œè€Œä¸æ˜¯ç§»é™¤ã€‚ä½†ä¸ºäº†ä»£ç ç®€çŸ­ï¼Œå…ˆç”¨ç§»é™¤æ³•ã€‚
        
        // æ”¹è¿›ï¼šä¸ºäº†ä¸è®©ä¸‹æ–¹ä¹±è·³ï¼Œæˆ‘ä»¬éœ€è¦åœ¨initæ—¶å›ºå®šä¸‹æ–¹æŒ‰é’®ï¼Œåªæ˜¯åˆ‡æ¢æ˜¾ç¤º/éšè—ã€‚
        // ä½†åœ¨è¿™ä¸ªè½»é‡ç‰ˆä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ï¼š
        // ä¸‹æ–¹åŒºåŸŸé‡æ–°æ¸²æŸ“ åŸå§‹ä¹±åºæ•°ç»„ ä¸­ æœªè¢«ä½¿ç”¨çš„ å®ä¾‹ã€‚
        
        // ç”±äºä¸ºäº†ç®€å•ï¼Œæˆ‘ä¿®æ”¹é€»è¾‘ï¼š
        // æ¯æ¬¡ç‚¹å‡»ï¼Œåªç§»åŠ¨DOMå…ƒç´ ï¼Œä¸å®Œå…¨é‡ç»˜ã€‚
    }

    // ---------------- DOM æ“ä½œé€»è¾‘ ----------------
    
    // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆå½“å‰å…³å¡çš„DOM
    function loadLevelDOM() {
         if (currentLevel >= levels.length) {
            gameComplete();
            return;
        }

        targetBox.innerHTML = '<span class="placeholder-text">ç‚¹å‡»è¯è¯­ç»„æˆå¥å­</span>';
        sourceBox.innerHTML = '';
        feedback.textContent = '';
        checkBtn.textContent = "æ£€æŸ¥å¥å­";
        checkBtn.onclick = checkAnswer;

        // æ›´æ–°è¿›åº¦æ¡
        progressBar.style.width = `${(currentLevel / levels.length) * 100}%`;

        let words = [...levels[currentLevel].words];
        // æ‰“ä¹±
        words.sort(() => Math.random() - 0.5);

        words.forEach((word, id) => {
            let btn = createWordBtn(word);
            // ç»™æ¯ä¸ªæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
            btn.onclick = function() {
                moveWord(this);
            };
            sourceBox.appendChild(btn);
        });
    }

    function createWordBtn(text) {
        let btn = document.createElement('div');
        btn.className = 'word-btn';
        btn.innerText = text;
        return btn;
    }

    // æ ¸å¿ƒç§»åŠ¨é€»è¾‘
    function moveWord(element) {
        // æ’­æ”¾è½»å¾®ç‚¹å‡»éŸ³æ•ˆ
        playTone(400, "sine", 0.1);

        if (element.parentElement === sourceBox) {
            // ä»ä¸‹æ–¹ç§»åˆ°ä¸Šæ–¹
            // ç§»é™¤å ä½ç¬¦
            const placeholder = targetBox.querySelector('.placeholder-text');
            if (placeholder) placeholder.style.display = 'none';
            targetBox.appendChild(element);
        } else {
            // ä»ä¸Šæ–¹ç§»å›ä¸‹æ–¹
            sourceBox.appendChild(element);
            // å¦‚æœä¸Šæ–¹ç©ºäº†ï¼Œæ˜¾ç¤ºå ä½ç¬¦
            if (targetBox.querySelectorAll('.word-btn').length === 0) {
                const placeholder = targetBox.querySelector('.placeholder-text');
                if (placeholder) placeholder.style.display = 'block';
            }
        }
    }

    // æ£€æŸ¥ç­”æ¡ˆ
    function checkAnswer() {
        // è·å–ä¸Šæ–¹æ‰€æœ‰çš„è¯
        const currentWords = Array.from(targetBox.querySelectorAll('.word-btn')).map(btn => btn.innerText);
        const userSentence = currentWords.join('');
        const correctSentence = levels[currentLevel].correct;

        if (userSentence === correctSentence) {
            // ç­”å¯¹äº†
            handleSuccess();
        } else {
            // ç­”é”™äº†
            handleError();
        }
    }

    function handleSuccess() {
        feedback.textContent = "å¤ªæ£’äº†ï¼ Perfect!";
        feedback.className = "feedback success-text";
        playTone(600, "triangle", 0.1); // æˆåŠŸéŸ³æ•ˆ
        playTone(800, "triangle", 0.1, 100); 
        
        // æ’’èŠ±ç‰¹æ•ˆ
        confettiEffect();

        // æŒ‰é’®å˜ä¸ºâ€œä¸‹ä¸€é¢˜â€
        checkBtn.textContent = "ä¸‹ä¸€é¢˜ ->";
        checkBtn.style.backgroundColor = "#29b6f6";
        checkBtn.style.boxShadow = "0 4px 0 #0288d1";
        checkBtn.onclick = () => {
            currentLevel++;
            loadLevelDOM();
        };
    }

    function handleError() {
        feedback.textContent = "ä¸å¯¹å“¦ï¼Œå†è¯•ä¸€æ¬¡ã€‚ Try again.";
        feedback.className = "feedback error-text";
        targetBox.classList.add('shake');
        playTone(200, "sawtooth", 0.3); // å¤±è´¥éŸ³æ•ˆ
        
        setTimeout(() => {
            targetBox.classList.remove('shake');
        }, 500);
    }

    function gameComplete() {
        targetBox.innerHTML = "ğŸ‰";
        sourceBox.innerHTML = "<h2>æ­å–œï¼ä½ å®Œæˆäº†æ‰€æœ‰ç»ƒä¹ ï¼</h2>";
        checkBtn.style.display = "none";
        progressBar.style.width = "100%";
        feedback.textContent = "";
    }

    // ---------------- ç®€æ˜“éŸ³æ•ˆåˆæˆå™¨ (æ— éœ€å¤–éƒ¨æ–‡ä»¶) ----------------
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, type, duration, delay = 0) {
        setTimeout(() => {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.type = type;
            oscillator.frequency.value = freq;
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start();
            
            // éŸ³é‡æ·¡å‡º
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);

            oscillator.stop(audioCtx.currentTime + duration);
        }, delay);
    }

    // ---------------- ç®€æ˜“æ’’èŠ±ç‰¹æ•ˆ ----------------
    function confettiEffect() {
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
        
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.style.position = 'fixed';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = '-10px';
            confetti.style.width = '10px';
            confetti.style.height = '10px';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.zIndex = '9999';
            confetti.style.transition = 'top 1s ease-out, transform 1s linear';
            
            document.body.appendChild(confetti);

            setTimeout(() => {
                confetti.style.top = '110vh';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            }, 10);

            setTimeout(() => {
                confetti.remove();
            }, 1000);
        }
    }

    // å¯åŠ¨æ¸¸æˆ
    loadLevelDOM();

</script>

</body>
</html>